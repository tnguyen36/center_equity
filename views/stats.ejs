<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset = "utf-8">
	<title>The Center of Equity and Inclusion</title>	
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
	<script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>
		//Script to print current date, retrieved from fellow student
		function printToday() {
		 	var today = new Date();
		 	document.write(today.toDateString());
		}
	</script>
	

</head>
<body id="bootstrap-override">
	Today's Date: <script>printToday();</script>
	<a href = "/">Homepage</a>
	<div class="container">	
			<% if(error && error.length > 0) { %>
				<div class="alert alert-danger" role="alert"><%= error %></div>
			<% } %>
			<% if(success && success.length > 0) { %>
				<div class="alert alert-success" role="alert"><%= success %></div>
			<% } %>
	</div>
	<div class="container-fluid text-center">
		<h1 class="display-4">User Statistics</h1>
		<div class="row totalCounts">
			<div class="col-sm-3 transparent-background">
				<h1 class="display-3"><%= userSum %></h1>
				<p class="lead stat-text">Total Users</p>				
			</div>
			<div class="col-sm-3 transparent-background">
				<h1 class="display-3"><%= loginSum %></h1>
				<p class="lead stat-text">Total Logins</p>				
			</div>
			<div class="col-sm-3 transparent-background">
				<h1 class="display-3"><%= users.length %></h1>
				<p class="lead stat-text">Daily Logins</p>				
			</div>
			<div class="col-sm-3 transparent-background">
				<h1 class="display-3"><%= newUsers.length %></h1>
				<p class="lead stat-text">Daily New Users</p>				
			</div>
		</div>
		<div class="row mt-4">
			<div class="col-sm-12 col-md-6 col-lg-4">				
				<div id="chartContainer" style="height: 360px; width: 100%;"></div>		
			</div>
			<div class="col-sm-12 col-md-6 col-lg-4">				
				<div id="chartContainer2" style="height: 360px; width: 100%;"></div>
			</div>
			<div class="col-sm-12 col-md-12 col-lg-4">				
				<div id="chartContainer3" style="height: 360px; width: 100%;"></div>
			</div>
		</div>

		<div class="col-sm-10 user-table">
			<div class="jumbotron mt-4">
			<h1 class="display-4">User List</h1>
			<button class="btn btn-primary">Get Subscriber List</button>
			<button class="btn btn-danger">Delete All Users</button>
		</div>
			<table class="table table-hover">
			  <thead class="thead-dark">
			    <tr>
			      <th scope="col">First Name</th>
			      <th scope="col">Last Name</th>   	
			      <th scope="col">Email</th>
			      <th scope="col">Member Type</th>
			      <th scope="col">Subscriber</th>
			      <th scope="col">Joined Date</th>
			      <th scope="col">Recent Login</th>
			    </tr>
			  </thead>
			  <tbody>
			  	<% userList.forEach(function(user) { %>
			  		<tr class="table-rows">
				      <td><%= user.firstName %></td>
				      <td><%= user.lastName %></td>
				      <td><%= user.username %></td>
				      <td><%= user.rank %></td>
				      <td><%= user.subscribe %></td>
				      <td><%= moment(user.userSince).format("MM/DD/YYYY") %></td>
				      <td><%= moment(user.lastLogin).format("MM/DD/YYYY") %></td>
			   	 	</tr>
			  	<% });%>
			  </tbody>
			</table>
		</div>

	</div>
	<script type="text/javascript">
		window.onload = function() {

		var options = {
			animationEnabled: true,
 			backgroundColor: "white",
			title: {
				text: "Distribution of Reasons",
				fontColor: "#4b2e83"
			},
			data: [{
				type: "pie",
				startAngle: 45,
				indexLabel: "{label} ({y})",
				yValueFormatString:"#,##0.#"%"",
				indexLabelFontWeight: "bold",
				dataPoints: [
					<% reasons.forEach(function(reason) { %>
						{ label: "<%= reason._id %>", y: <%= reason.total %> },
					<%});%>						
				]
			}]
		};
		var options2 = {
			animationEnabled: true,
 			backgroundColor: "white",
			title: {
				text: "Distribution of Members",
				fontColor: "#4b2e83"
			},
			data: [{
				type: "pie",
				startAngle: 45,
				indexLabel: "{label} ({y})",
				yValueFormatString:"#,##0.#"%"",
				indexLabelFontWeight: "bold",
				dataPoints: [
					<% ranks.forEach(function(rank) { %>
						{ label: "<%= rank._id %>", y: <%= rank.total %> },
					<%});%>						
				]
			}]
		};
		var chart = new CanvasJS.Chart("chartContainer3", {
			animationEnabled: true,
			
			title:{
				text:"Subscribers",
				fontColor: "#4b2e83"
			},
			axisX:{
				interval: 1,
			
			},
			axisY2:{
				interlacedColor: "rgba(75, 46, 131,0.05)",
				gridColor: "rgba(1,77,101,.1)",
			},
			data: [{
				type: "bar",
				name: "companies",
				axisYType: "secondary",
				color: "#4b2e83",
				indexLabelFontWeight: "bold",
				dataPoints: [
					<% subscribe.forEach(function(subscribe) { %>
						{ y: <%= subscribe.total %>, label: "<%= subscribe._id.toUpperCase() %>" },
					<%});%>					
				]
			}]
		});
		chart.render();
		$("#chartContainer").CanvasJSChart(options);
		$("#chartContainer2").CanvasJSChart(options2);

		}
	</script>
	
	<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>  
	<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
</body>
</html>